
\documentclass{article}
\title{SafeStreets DD}
\date{release date: \today\\version 1}
\author{Matteo Secco, Mohammad Rahbari}
\usepackage{enumitem}
\usepackage{siunitx}
\usepackage{float}
\usepackage{graphicx}
\usepackage[margin=2.5cm]{geometry}
\usepackage{color}
\usepackage[dvipsnames]{xcolor}
\usepackage{listings}
\usepackage{subcaption}
\usepackage{hyperref}
\newcommand{\enum}[1]{\texttt{#1.\arabic*}}
\newcommand{\link}[2]{{\color{blue}\underline{\href{#1}{#2}}}}
\begin{document}
\pagenumbering{gobble}
\maketitle
\newpage
\tableofcontents
\pagebreak
\pagenumbering{arabic}

\input{../Common/Introduction.tex}
	\subsection{Revision history}
	\subsection{Reference documents}
	\subsection{Document Structure}

\section{Architectural Design}
	\subsection{Overview} \textit{High-level components and their interaction}
	In this section the architectural design of SafeStreets is presented. 
	\begin{list}{$\bullet$}{The presentation is divided into the following parts:}
		\item \textbf{High level architecture:} 
			This section will provide an high level view of the system architecture.
		\item \textbf{Data model:}
			This part will describe the Database structure.
		\item \textbf{Component view:} 
			This part will introduce all the components the system will be made from, their functionalities and their interactions.
		\item \textbf{Deployment view:} 
			This part describes the hardware that will compose the system as well as the software that will be runned on it.
		\item \textbf{Runtime view:} 
			This parts describes in detail the executon behaviour of each component.
		\item \textbf{Component interfaces:} 
			This pat describes the interface that the components will use to communicate one with the other, as well as the interfaces with other
			systems.
		\item \textbf{Selected architectural styles and patterns:} 
			This parts describes the design choices  about the architecture of the application.
	\end{list}
	\subsection{High level architecture}
	\subsection{Component view} \label{Section:Component view} \textit{Here we thescribe how the project can be modularized}\\
	\begin{figure}
		\includegraphics[width=\linewidth]{images/Component_Diagram.png}
		\caption{Component Diagram (Client components are omitted for brevity)}
	\end{figure}
	The following table collects the component by functional group and by user group:
	\begin{table}[H]
	\begin{center}
		\caption{Components}
		\small
		\begin{tabular}{|l|l|l|l|l|l|}
		\hline
		&\textbf{Security}			&\textbf{Interfaces}	&\textbf{Presentation}		&\textbf{Data manipulation}	&\textbf{Storage}\\
		\hline
		\textbf{Server}	
		&AuthenticationManager		&HtmlServer			&NotificationManager			&ComputerVisionEngine		&	DBMS\\
		&SignupController			&MailServer			&MapBuilder					&DataMiningEngine			&		\\
		&EncryptionService			&RestApi		&TopViolatorsRankingBuilder	&TicketManager				&		\\
		&							&					&StatisticsPresenter			&							&		\\
		&							&					&TicketPresenter				&							&		\\
		&							&					&JSP							&							&		\\
		\hline
		\textbf{Citizen}
		&EncryptionService			&RestApi		&MapDisplayer				&CameraManager				&		\\
		&							&					&TopViolatorsDisplayer		&GPSManager					&		\\
		&							&					&NotificationService			&CurrentTimeManager			&		\\
		\hline
		\textbf{Authority}
		&							&WebBrowser			&WebBrowser					&							&		\\
		\hline
		\end{tabular}
	\end{center}
	\end{table}
	The following list provides a detailed description of each module's functionalities (calls to components are omitted here as they will be
	datailed in sequence diagrams):
	\begin{itemize}
		\item \label{component:AuthenticationManager} \textbf{AuthenticationManager:}
			This module will authenticate the user comparing the provided credentials with the ones stored to the database, and if a match is found
			will generate a session token for authentication. The provided password will be hashed before comparison (as passwords won't be stored
			in plain text). The usage of a token (nounce) can prevent many malicious attacks, such as 
		 	\link{https://en.wikipedia.org/wiki/Cross-site_request_forgery}{Csrf attacks} or 
			\link{https://en.wikipedia.org/wiki/Replay_attack}{Replay attacks}. 
		 \item \label{component:SignupController} \textbf{SignupController:} 
		 	This component will manage the signup procedure, in particular it's main functionalities will be: reciving a signup request, check the
		 	constraints of the provided data (in example, unicity of username and email, strength of the password), hash the password, temporary store these data, 
		 	generate and send a token to the given email to verify it, persistently store the data. The email validation can provide some protection against
		 	\link{https://en.wikipedia.org/wiki/Denial-of-service_attack}{DoS attacks}, but full protection is
		 	currently unachievable (many researches are running to find a solution)
		 \item \label{component:EncryptionService} \textbf{EncryptionService:}
		 	\link{https://en.wikipedia.org/wiki/Bcrypt}{BCrypt}
		 \item \label{component:HtmlServer} \textbf{HtmlServer:}
		 	This component is an interface to handle \link{https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol}{http} requests for the HTML pages to be displayed
		 	on a web browser. 
		 \item \label{component:MailServer} \textbf{MailServer:} 
		 	This component is an interface for mail sending emails to the users, in particular notifications (i.e: a ticket has been issued to them) and the first email
		 	used to confirm the email address.
		 \item \label{component:RestApi} \textbf{RestApi:} 
		 	This component will handle the custom messaging protocol with Citizen's devices. The communication will rely on HTTPS, in order to protect the system from 
		 	\link{https://en.wikipedia.org/wiki/Man-in-the-middle_attack}{Man in the Middle attacks}.
		 \item \label{component:JSP} \textbf{\link{https://en.wikipedia.org/wiki/JavaServer_Pages}{JSP:}}
		 	This component, relying on a well-known technology, will dynamically create HTML data starting from given templates and data.
		 \item \label{component:NotificationManager} \textbf{NotificationManager:}
		 	This component will decide when is needed to send a notification to an User, by sending an email in case of Authorities, or by displaying a notification 
		 	on the application and/or sending an email in case of Citizens, according to the preferences they setted.
		 \item \label{component:MapBuilder} \textbf{MapBuilder:}
		 	This component is responsible to aggregate data from the database according to a geographical location, and to create the data needed to display them
		 	using the Google Maps API.
		 \item \label{component:TopViolatorsRankingBuilder} \textbf{TopViolatorsRankingBuilder:}
		 	This component will query the database for Violations based on a geographical location, hide the plate from pictures and
		 	generate the list for the Top Violators page.
		 \item \label{component:ComputerVisionEngine} \textbf{ComponentVisionEngine:}
		 	The main functionality of this component is to recive a picture and extract the car plate out of it.
		 	It will also be used to hide the plates from the TopViolatorsRanking.
		 \item \label{component:DataMiningEngine} \textbf{DataMiningEngine:}
		 	This component will run data mining algorithms on the database to discover relevant informations with regard to specific geographical
		 	locations.
		 \item \label{component:TicketManager} \textbf{TicketManager:}
		 	This component will filter incoming notifications in order to avoid to store non-ticketable violations, and provide stored violations that are
		 	issuable on demand.
		 \item \label{component:CameraManager} \textbf{CameraManager:}
		 	This component will grant secure access to the camera of a Citizen's device, preventing it from notifying violations if the camera is not 
		 	available (for hardware fault or denied permission).
		 \item \label{component:GPSManager} \textbf{GPSManager:}
		 	This component will regulate the access to the GPS of the citizen device, as well as the gathering of the position.
		 \item \label{component:CurrentTimeManager} \textbf{CurrentTimeManager:}
		 	This component will check if the date and time settings on the user device are set to auto (the device synchronizes it's clock using 
		 	internet or the GPS). If they are, the current time is collected, otherwise the notification is blocked until the settings are changed
		 \item \label{component:DBMS} \textbf{DBMS:}
		 	This component will be respopnsible of managing the database.
	\end{itemize}
	\newpage
	\subsection{Deployment view} How the modules are implemented, explaying both hardware and software
	\begin{figure}[H]
		\includegraphics[width=\linewidth]{images/Deployment_diagram.png}
		\caption{Deployment diagram}
	\end{figure}
	\newpage
	\subsection{Runtime view} The following diagrams show the interactions between components in order to achieve the
	required functions
	\begin{figure}[H]
		\includegraphics[width=\linewidth]{images/Register_citizen_sequence_diagram.png}
		\caption{Register citizen sequence diagram}
	\end{figure}
	\begin{figure}[H]
		\includegraphics[width=\linewidth]{images/Register_authority_sequence_diagram.png}
		\caption{Register authority sequence diagram}
	\end{figure}
	\begin{figure}[H]
		\includegraphics[width=\linewidth]{images/Login(Citizen)_sequence_diagram.png}
		\caption{Login citizen sequence diagram}
	\end{figure}
	\begin{figure}[H]
		\includegraphics[width=\linewidth]{images/Login(authority)_sequence_diagram.png}
		\caption{Login authority sequence diagram}
	\end{figure}
	
	\begin{figure}[H]
		\includegraphics[width=\linewidth]{images/See_statistics_sequence_diagram.png}
		\caption{See statistics sequence diagram}
	\end{figure}
	\begin{figure}[H]
		\includegraphics[width=\linewidth]{images/See_Top_Violators_Sequence_Diagram.png}
		\caption{See top violators ranking sequence diagram}
	\end{figure}
	
	
	\newpage
	\subsection{Component Interfaces}
	The following diagram illustrates the interfaces and the dependencies between different components.
		\begin{figure}[H]
			\includegraphics[width=\linewidth]{images/Interface_diagram.png}
			\caption{Component interfaces diagram}
		\end{figure}
	\subsection{Selected architectural styles and patterns} Please	explain	which	styles/patterns	you	used,	
why,	and	how
		\subsubsection{REST paradigm}
			We decided to design the system following the REpresentational State Transfer paradigm, 				in order to reduce the design complexity and improve reusability and maintainability.
			Following are stated the key concepts of REST and how they're 
			\begin{itemize}
				\item \textbf{Client-server architecture}
				\item \textbf{Stateless:} 
					The components does not store information of what they are doing. Every request comes with all the needed data to
					provide a response, or any missing data can be retrieved from the database or by transforming the already available
					data.
				\item \textbf{Cacheability:} 
					All the responses are marked as cacheable or not (if a response can be cached, overall 
					latency can be significantly reduced)
				\item \textbf{Layered:} 
					As pointed in \ref{somewhere}, the system is organized in layers and provide
					interfaces to external processes (controlled by users or automated=
				\item \textbf{Uniform interface:} 
					Uniformity of the interface is granded by exposing HTTP endpoints, which transmit resources using
					the \link{https://json.org/json-en.html}{JSON} format.
					\subitem \textbf{Resource identification:} 
						Evevry data exposed to the outside and not representational (Webpages) is 
						encoded in the JSON format. Web pages are obviously provided in 
						\link{https://en.wikipedia.org/wiki/HTML}{HTML} format, in order to be displayable by
						common web browsers.
					\subitem \textbf{Resource manipulation through representations:}
						The format of the resources can be easly modified, as are represented
						in a structured text format
					\subitem \textbf{Self-descriptive messages:}
						The JSON format names every data exchanged. The names we use are
						expressive enought to be self-descriptive
					\subitem \textbf{Hypermedia as the engine of application state:}
						Concerning the API, we provide a service broker to expose all of the
						interface mathods. With regard to the web application, it's navigable 
						using web links (see \ref{fig:homepage})
			\end{itemize}
		\subsubsection{MVC pattern}
			The \link{https://en.wikipedia.org/wiki/Model-view-controller}{Model, View, Controller} pattern is a widely 
			used pattern. Its main advantage is a significant reduction of the complexity, granted by a layered
			structure that subdivides responsibilities.
	\subsection{Other design decisions}
\section{User Interface Design}Provide	an	overview	on	how	the	user	interface(s)	of	your	system	will	
look	like; if	you	 have	included	 this	 part	in	 the	 RASD,	you	 can	 simply	 refer	 to	what	you	 have	
already	done,	possibly,	providing	here	some	extensions	if	applicable.
	\subsection{Mobile application interface}
		\begin{figure}[H]
			\centering
			\begin{subfigure}[H]{0.49\linewidth}
				\includegraphics[width=\linewidth]{images/Sign_In.png}
				\caption{Sign in}
			\end{subfigure}	
			\begin{subfigure}[H]{0.49\linewidth}
				\includegraphics[width=\linewidth]{images/Sign_Up.png}
				\caption{Sign up}
			\end{subfigure}
		\end{figure}
		\begin{figure}[H]
			\begin{subfigure}[H]{0.49\linewidth}
				\includegraphics[width=\linewidth]{images/Menu.png}
				\caption{Menu}
			\end{subfigure}
			\begin{subfigure}[H]{0.49\linewidth}
				\includegraphics[width=\linewidth]{images/Camera.png}
				\caption{Camera}
			\end{subfigure}
		\end{figure}
		\begin{figure}[H]
			\begin{subfigure}[H]{0.49\linewidth}
				\includegraphics[width=\linewidth]{images/Maps.png}
				\caption{Map}
			\end{subfigure}
			\begin{subfigure}[H]{0.49\linewidth}
				\includegraphics[width=\linewidth]{images/Top_Violators.png}
				\caption{Top Violators}
			\end{subfigure}
		\end{figure}			
	\subsection{Web application interface}
		\label{fig:homepage}
		\begin{figure}[H]
			\includegraphics[width=\linewidth]{images/home.png}
			\caption{Home page}
		\end{figure}
		\begin{figure}[H]
			\includegraphics[width=\linewidth]{images/map.png}
			\caption{City map with risky streets marked}
		\end{figure}
		\begin{figure}[H]
			\includegraphics[width=\linewidth]{images/ticketing.png}
			\caption{Insert ticket informations}
		\end{figure}
		\begin{figure}[H]
			\includegraphics[width=\linewidth]{images/log in.png}
			\caption{Login screen}
		\end{figure}
	
\section{Requirement traceability}	Explain	how	the	requirements	you	have	defined	in	the	RASD	
map	to the	design	elements	that	you	have	defined	in	this	document
\section{Implementation, Integration and Test plan}	Identify	here	the	order	in	which	you	plan	
to	implement	the	subcomponents	of	your	system	and	the	order	in	which	you	plan	to	integrate	
such	subcomponents	and	test	the	integration.	
\section{Effort spent}In	 this	 section	you	will	include	information	about	 the	number	of	hours	each	
group	member	has	worked	for	this	document.
	\paragraph{Matteo Secco}
		\begin{itemize}
			\item 25 November: Components, toghether. 3h
			\item 27 November: Components. 3h
			\item 29 November: Deployment. 4h
			\item 5 December: Inserted images, refactor structure. 1h
			\item 7 December: Sequence diagrams. 5h
		\end{itemize}
	\paragraph{Rahbari}
		\begin{itemize}
			\item 25 November: Components, toghether. 3h
			\item 27.28 November: Interface. 3h
		\end{itemize}
\section{References}

\end{document}